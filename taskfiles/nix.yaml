version: "3"

tasks:
  build:
    desc: Build both NixOS images (gatus and foundry)
    cmds:
      - task: build:gatus
      - task: build:foundry

  build:gatus:
    desc: Build the Gatus monitoring image
    cmds:
      - nix build .#nixosConfigurations.gatus.config.system.build.digitalOceanImage --system x86_64-linux

  build:foundry:
    desc: Build the Foundry VTT image
    cmds:
      - nix build .#nixosConfigurations.foundry.config.system.build.digitalOceanImage --system x86_64-linux

  deploy:
    desc: Deploy both NixOS configurations (gatus and foundry)
    cmds:
      - deploy path:.#

  deploy:gatus:
    desc: Deploy only Gatus configuration
    cmds:
      - deploy path:.#gatus

  deploy:foundry:
    desc: Deploy only Foundry configuration
    cmds:
      - deploy path:.#foundry

  cache:
    desc: Cache build products and dependencies
    cmds:
      - ./scripts/cache
